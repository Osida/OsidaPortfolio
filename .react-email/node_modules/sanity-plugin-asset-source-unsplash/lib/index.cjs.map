{"version":3,"file":"index.cjs","sources":["../src/components/Icon.tsx","../src/datastores/unsplash.ts","../src/components/Photo.styled.tsx","../src/components/Photo.tsx","../src/components/UnsplashAssetSource.styled.tsx","../src/components/UnsplashAssetSource.tsx","../src/index.ts"],"sourcesContent":["import React from 'react'\n\nexport default function UnsplashIcon() {\n  return (\n    <svg role=\"img\" viewBox=\"0 0 25 25\" width=\"1em\" height=\"1em\" fill=\"currentColor\">\n      <title />\n      <path d=\"M9 9V4h7v5H9Zm7 3h5v9H4v-9h5v5h7v-5Z\" />\n    </svg>\n  )\n}\n","import { SanityClient } from '@sanity/client'\nimport { BehaviorSubject, concat, defer, Observable } from 'rxjs'\nimport { debounceTime, distinctUntilChanged, map, switchMap, withLatestFrom } from 'rxjs/operators'\n\nimport { UnsplashPhoto } from '../types'\n\ntype SearchSubject = BehaviorSubject<string>\ntype PageSubject = BehaviorSubject<number>\n\nconst fetchSearch = (\n  client: SanityClient,\n  query: string,\n  page: number,\n  perPage: number\n): Observable<any> =>\n  defer(\n    () =>\n      client.observable.request({\n        url: `/addons/unsplash/search/photos?query=${encodeURIComponent(\n          query\n        )}&page=${page}&per_page=${perPage}`,\n        withCredentials: true,\n        method: 'GET',\n      }) as any\n  )\n\nconst fetchList = (\n  client: SanityClient,\n  type: string,\n  page: number,\n  perPage: number\n): Observable<any> =>\n  defer(\n    () =>\n      client.observable.request({\n        url: `/addons/unsplash/photos?order_by=${type}&page=${page}&per_page=${perPage}`,\n        withCredentials: true,\n        method: 'GET',\n      }) as any\n  )\n\nexport function fetchDownloadUrl(client: SanityClient, photo: UnsplashPhoto): Promise<string> {\n  const downloadUrl = photo.links.download_location.replace(\n    'https://api.unsplash.com',\n    '/addons/unsplash'\n  )\n  return client\n    .request({\n      url: downloadUrl,\n      withCredentials: true,\n      method: 'GET',\n    })\n    .then((result: { url: string }) => {\n      return result.url\n    })\n}\n\nexport const search = (\n  client: SanityClient,\n  query: SearchSubject,\n  page: PageSubject,\n  resultsPerPage: number\n): Observable<any> => {\n  return concat(\n    query.pipe(\n      withLatestFrom(page),\n      debounceTime(500),\n      distinctUntilChanged(),\n      switchMap(([q, p]) => {\n        if (q) {\n          return fetchSearch(client, q, p, resultsPerPage).pipe(\n            distinctUntilChanged(),\n            map((result) => result.results)\n          )\n        }\n        return fetchList(client, 'popular', p, resultsPerPage)\n      })\n    )\n  )\n}\n","import { Card, Theme } from '@sanity/ui'\nimport styled from 'styled-components'\n\ntype SanityTheme = Theme['sanity']\n\ninterface Style {\n  studioTheme: SanityTheme\n}\n\nexport const Root = styled.div`\n  overflow: hidden;\n  background-origin: content-box;\n  background-repeat: no-repeat;\n  background-clip: border-box;\n  background-size: cover;\n  position: relative;\n  outline: none !important;\n  border: ${({ studioTheme }: Style) => `1px solid ${studioTheme.color.card.enabled.border}`};\n  box-sizing: content-box;\n  user-drag: none;\n\n  &:hover {\n    opacity: 0.85;\n  }\n\n  &:focus,\n  &:active {\n    border: 1px solid var(--input-border-color-focus);\n    box-shadow: inset 0 0 0 3px var(--input-border-color-focus);\n  }\n`\n\nexport const CreditLineLink = styled.a`\n  text-decoration: none;\n  cursor: pointer;\n`\n\nexport const CreditLine = styled(Card)`\n  ${({ theme }) => `\n     --creditline-fg: ${theme.sanity.color.card.enabled.fg};\n     --creditline-bg: ${theme.sanity.color.card.enabled.bg};\n   `};\n  user-drag: none;\n  position: absolute;\n  background-color: var(--creditline-bg);\n  bottom: 0;\n\n  [data-ui='Text'] {\n    color: var(--creditline-fg);\n  }\n`\n","import { Text, useTheme } from '@sanity/ui'\nimport React, { useCallback, useEffect } from 'react'\n\nimport { UnsplashPhoto } from '../types'\nimport { CreditLine, CreditLineLink, Root } from './Photo.styled'\n\ntype Props = {\n  data: UnsplashPhoto\n  width: number\n  height: number\n  onClick: (photo: UnsplashPhoto) => void\n  onKeyDown: (event: any) => void\n  active: boolean\n  onFocus: (photo: UnsplashPhoto) => void\n}\n\nconst UTM_SOURCE = 'sanity-plugin-asset-source-unsplash'\n\nexport default function Photo(props: Props) {\n  const { onClick, data, onKeyDown, onFocus, active, width, height } = props\n\n  const handleClick = useCallback(() => {\n    onClick(data)\n  }, [onClick, data])\n\n  const handleCreditLineClicked = useCallback(\n    (event: any) => {\n      event.stopPropagation()\n      const url = `${data.links.html}?utm_source=${encodeURIComponent(\n        UTM_SOURCE\n      )}&utm_medium=referral`\n      window.open(url, data.id, 'noreferrer,noopener')\n    },\n    [data]\n  )\n\n  const handleKeyDown = useCallback(\n    (event: any) => {\n      onKeyDown(event)\n      if (event.keyCode === 13) {\n        onClick(data)\n      }\n    },\n    [onKeyDown, data, onClick]\n  )\n\n  const handleMouseDown = useCallback(() => {\n    onFocus(data)\n  }, [onFocus, data])\n\n  useEffect(() => {\n    if (active) {\n      onFocus(data)\n    }\n  }, [active, data, onFocus])\n\n  const src = data.urls.small\n  const userName = data.user.name\n\n  const theme = useTheme().sanity\n  return (\n    <Root\n      studioTheme={theme}\n      title={`Select image by ${userName} from Unsplash`}\n      tabIndex={0}\n      onKeyDown={handleKeyDown}\n      onMouseDown={handleMouseDown}\n      style={{\n        width: `${width}px`,\n        height: `${height}px`,\n        backgroundImage: `url(\"${src}\")`,\n      }}\n      onClick={handleClick}\n    >\n      <CreditLineLink onClick={handleCreditLineClicked}>\n        <CreditLine padding={2} radius={2} margin={2}>\n          <Text size={1} title={`Open image by ${userName} on Unsplash in new window`}>\n            By @{data.user.username}\n          </Text>\n        </CreditLine>\n      </CreditLineLink>\n    </Root>\n  )\n}\n","import { Stack } from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const Search = styled(Stack)`\n  position: sticky;\n  top: 0;\n  z-index: 1;\n`\n\nexport const Scroller = styled.div`\n  overflow-y: auto;\n  max-height: 80vh;\n`\n","import { SanityClient } from '@sanity/client'\nimport { Card, Dialog, Flex, Spinner, Stack, Text, TextInput } from '@sanity/ui'\nimport React from 'react'\nimport InfiniteScroll from 'react-infinite-scroll-component'\nimport PhotoAlbum from 'react-photo-album'\nimport { BehaviorSubject, Subscription } from 'rxjs'\nimport { AssetFromSource, AssetSourceComponentProps, useClient } from 'sanity'\n\nimport { fetchDownloadUrl, search } from '../datastores/unsplash'\nimport { UnsplashPhoto } from '../types'\nimport Photo from './Photo'\nimport { Search } from './UnsplashAssetSource.styled'\n\ntype State = {\n  query: string\n  searchResults: UnsplashPhoto[][]\n  page: number\n  isLoading: boolean\n  cursor: number\n}\n\nconst RESULTS_PER_PAGE = 42\nconst PHOTO_SPACING = 2\nconst PHOTO_PADDING = 1 // offset the 1px border width\n\nexport default function UnsplashAssetSource(props: AssetSourceComponentProps) {\n  const client = useClient({ apiVersion: '2022-09-01' })\n  return <UnsplashAssetSourceInternal {...props} client={client} />\n}\n\nclass UnsplashAssetSourceInternal extends React.Component<\n  AssetSourceComponentProps & { client: SanityClient },\n  State\n> {\n  static defaultProps = {\n    selectedAssets: undefined,\n  }\n\n  state = {\n    cursor: 0,\n    query: '',\n    page: 1,\n    searchResults: [[]],\n    isLoading: true,\n  }\n\n  searchSubscription: Subscription | null = null\n\n  searchSubject$ = new BehaviorSubject('')\n  pageSubject$ = new BehaviorSubject(1)\n\n  componentDidMount() {\n    this.searchSubscription = search(\n      this.props.client,\n      this.searchSubject$,\n      this.pageSubject$,\n      RESULTS_PER_PAGE\n    ).subscribe({\n      next: (results: UnsplashPhoto[]) => {\n        this.setState((prev) => ({\n          searchResults: [...prev.searchResults, results],\n          isLoading: false,\n        }))\n      },\n    })\n  }\n\n  componentWillUnmount() {\n    if (this.searchSubscription) {\n      this.searchSubscription.unsubscribe()\n    }\n  }\n\n  handleSelect = (photo: UnsplashPhoto) => {\n    this.setState({ isLoading: true })\n    return fetchDownloadUrl(this.props.client, photo).then((downloadUrl) => {\n      const description = photo.description || undefined\n      const asset: AssetFromSource = {\n        kind: 'url',\n        value: downloadUrl,\n        assetDocumentProps: {\n          _type: 'sanity.imageAsset',\n          source: {\n            name: 'unsplash',\n            id: photo.id,\n            url: photo.links.html,\n          },\n          description,\n          creditLine: `${photo.user.name} by Unsplash`,\n        } as any,\n      }\n      this.props.onSelect([asset])\n    })\n  }\n\n  handleClose = () => {\n    this.props.onClose()\n  }\n\n  handleSearchTermChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const query = event.currentTarget.value\n    this.setState({ query, page: 1, searchResults: [[]], isLoading: true, cursor: 0 })\n    this.pageSubject$.next(1)\n    this.searchSubject$.next(query)\n  }\n\n  handleScollerLoadMore = () => {\n    // eslint-disable-next-line react/no-access-state-in-setstate\n    const nextPage = this.state.page + 1\n    this.setState({ page: nextPage, isLoading: true })\n    this.pageSubject$.next(nextPage)\n    this.searchSubject$.next(this.state.query)\n  }\n\n  handleKeyDown = (event: any) => {\n    const { cursor } = this.state\n    if ((event.keyCode === 38 || event.keyCode === 37) && cursor > 0) {\n      this.setState((prevState) => ({\n        cursor: prevState.cursor - 1,\n      }))\n    } else if (\n      (event.keyCode === 40 || event.keyCode === 39) &&\n      cursor < this.getPhotos().length - 1\n    ) {\n      this.setState((prevState) => ({\n        cursor: prevState.cursor + 1,\n      }))\n    }\n  }\n\n  getPhotos() {\n    return this.state.searchResults.flat()\n  }\n\n  updateCursor = (photo: UnsplashPhoto) => {\n    const index = this.getPhotos().findIndex((result: UnsplashPhoto) => result.id === photo.id)\n    this.setState({ cursor: index })\n  }\n\n  renderImage = (props: any) => {\n    const { photo, layout } = props\n    const active =\n      this.getPhotos().findIndex((result: UnsplashPhoto) => result.id === photo.data.id) ===\n        this.state.cursor || false\n    return (\n      <Photo\n        onClick={this.handleSelect.bind(photo.data)}\n        onKeyDown={this.handleKeyDown}\n        data={photo.data}\n        width={layout.width}\n        height={layout.height}\n        active={active}\n        onFocus={this.updateCursor}\n      />\n    )\n  }\n\n  render() {\n    const { query, searchResults, isLoading } = this.state\n\n    return (\n      <Dialog\n        id=\"unsplash-asset-source\"\n        header=\"Select image from Unsplash\"\n        onClose={this.handleClose}\n        open\n        width={4}\n      >\n        <Stack space={3} padding={4}>\n          <Card>\n            <Search space={3}>\n              <Text size={1} weight=\"semibold\">\n                Search Unsplash\n              </Text>\n              <TextInput\n                label=\"Search Unsplash.com\"\n                placeholder=\"Topics or colors\"\n                value={query}\n                onChange={this.handleSearchTermChanged}\n              />\n            </Search>\n          </Card>\n          {!isLoading && this.getPhotos().length === 0 && (\n            <Text size={1} muted>\n              No results found\n            </Text>\n          )}\n          <InfiniteScroll\n            dataLength={this.getPhotos().length} // This is important field to render the next data\n            next={this.handleScollerLoadMore}\n            // scrollableTarget=\"unsplash-scroller\"\n            hasMore\n            scrollThreshold={0.99}\n            height=\"60vh\"\n            loader={\n              <Flex align=\"center\" justify=\"center\" padding={3}>\n                <Spinner muted />\n              </Flex>\n            }\n            endMessage={\n              <Text size={1} muted>\n                No more results\n              </Text>\n            }\n          >\n            {searchResults\n              .filter((photos) => photos.length > 0)\n              .map((photos: UnsplashPhoto[], index) => (\n                <PhotoAlbum\n                  // eslint-disable-next-line react/no-array-index-key\n                  key={`gallery-${query || 'popular'}-${index}`}\n                  layout=\"rows\"\n                  spacing={PHOTO_SPACING}\n                  padding={PHOTO_PADDING}\n                  targetRowHeight={(width) => {\n                    if (width < 300) return 150\n                    else if (width < 600) return 200\n                    return 300\n                  }}\n                  photos={photos.map((photo: UnsplashPhoto) => ({\n                    src: photo.urls.small,\n                    width: photo.width,\n                    height: photo.height,\n                    key: photo.id,\n                    data: photo,\n                  }))}\n                  renderPhoto={this.renderImage}\n                  componentsProps={{\n                    containerProps: { style: { marginBottom: `${PHOTO_SPACING}px` } },\n                  }}\n                />\n              ))}\n          </InfiniteScroll>\n        </Stack>\n      </Dialog>\n    )\n  }\n}\n","import { AssetSource, definePlugin } from 'sanity'\n\nimport Icon from './components/Icon'\nimport Unsplash from './components/UnsplashAssetSource'\n\nexport type { Asset, AssetDocument, UnsplashPhoto } from './types'\n\n/**\n * @public\n */\nexport const unsplashAssetSource: AssetSource = {\n  name: 'unsplash',\n  title: 'Unsplash',\n  component: Unsplash,\n  icon: Icon,\n}\n\n/**\n * @public\n */\nexport const unsplashImageAsset = definePlugin({\n  name: 'asset-source-unsplash-plugin',\n\n  form: {\n    image: {\n      assetSources: (prev) => {\n        return [...prev, unsplashAssetSource]\n      },\n    },\n  },\n})\n"],"names":["UnsplashIcon","jsxs","role","viewBox","width","height","fill","children","jsx","d","fetchSearch","client","query","page","perPage","defer","observable","request","url","encodeURIComponent","concat","withCredentials","method","fetchList","type","fetchDownloadUrl","photo","downloadUrl","links","download_location","replace","then","result","search","resultsPerPage","pipe","withLatestFrom","debounceTime","distinctUntilChanged","switchMap","_ref","q","p","map","results","Root","styled","default","div","_templateObject","_taggedTemplateLiteral","_ref2","studioTheme","color","card","enabled","border","CreditLineLink","a","_templateObject2","CreditLine","Card","_templateObject3","_ref3","theme","sanity","fg","bg","UTM_SOURCE","Photo","props","onClick","data","onKeyDown","onFocus","active","handleClick","useCallback","handleCreditLineClicked","event","stopPropagation","html","window","open","id","handleKeyDown","keyCode","handleMouseDown","useEffect","src","urls","small","userName","user","name","useTheme","title","tabIndex","onMouseDown","style","backgroundImage","padding","radius","margin","Text","size","username","Search","Stack","_templateObject4","_templateObject5","RESULTS_PER_PAGE","PHOTO_SPACING","PHOTO_PADDING","UnsplashAssetSource","useClient","apiVersion","UnsplashAssetSourceInternal","React","Component","constructor","arguments","state","cursor","searchResults","isLoading","searchSubscription","searchSubject$","BehaviorSubject","pageSubject$","handleSelect","setState","description","asset","kind","value","assetDocumentProps","_type","source","creditLine","onSelect","handleClose","onClose","handleSearchTermChanged","currentTarget","next","handleScollerLoadMore","nextPage","prevState","getPhotos","length","updateCursor","index","findIndex","renderImage","layout","bind","componentDidMount","subscribe","prev","componentWillUnmount","unsubscribe","flat","render","Dialog","header","space","weight","TextInput","label","placeholder","onChange","muted","InfiniteScroll","dataLength","hasMore","scrollThreshold","loader","Flex","align","justify","Spinner","endMessage","filter","photos","PhotoAlbum","spacing","targetRowHeight","key","renderPhoto","componentsProps","containerProps","marginBottom","defaultProps","selectedAssets","unsplashAssetSource","component","Unsplash","icon","Icon","unsplashImageAsset","definePlugin","form","image","assetSources"],"mappings":"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"}